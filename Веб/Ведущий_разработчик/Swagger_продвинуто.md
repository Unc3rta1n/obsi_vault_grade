Swagger (или OpenAPI) — это спецификация для описания RESTful API. FastAPI использует автоматическую генерацию документации через Swagger UI, которая позволяет удобно тестировать и взаимодействовать с API. В этом разделе рассмотрим более продвинутые возможности работы с Swagger в FastAPI.

### 1. Настройка Swagger UI

FastAPI генерирует автоматическую документацию для вашего API через Swagger UI, которая доступна по умолчанию по адресу `http://127.0.0.1:8000/docs`. Однако, вы можете настроить Swagger UI, чтобы настроить внешний вид документации и добавить дополнительные настройки, такие как описание и контактные данные.

#### Пример настройки Swagger UI:
```python
from fastapi import FastAPI

app = FastAPI(
    title="Мой API",
    description="Документация для моего API",
    version="1.0.0",
    contact={
        "name": "Разработчик API",
        "email": "developer@example.com",
    },
)

@app.get("/")
async def read_root():
    return {"message": "Hello, FastAPI!"}
````

В этом примере задаются настройки для документации Swagger, включая заголовок, описание и контактные данные.

### 2. Описание моделей и аннотаций

FastAPI использует Pydantic для создания и валидации данных, и эти модели автоматически включаются в документацию Swagger. Важно правильно описывать модели и аннотировать их типы, чтобы документация была как можно более понятной и точной.

#### Пример документации для модели:

```python
from pydantic import BaseModel

class Item(BaseModel):
    name: str
    description: str = None
    price: float
    tax: float = None

@app.post("/items/")
async def create_item(item: Item):
    return {"item": item.name, "price": item.price}
```

Swagger автоматически отобразит поля модели `Item` с описаниями типов и значений.

### 3. Аннотации для параметров запроса и тела запроса

FastAPI поддерживает множество аннотаций для параметров запроса и тела запроса, которые можно использовать для улучшения документации и контроля входных данных. Использование этих аннотаций позволит Swagger UI отображать корректную информацию о параметрах.

#### Пример аннотации для параметров запроса и тела:

```python
from fastapi import Query

@app.get("/items/")
async def get_items(q: str = Query(..., max_length=50, description="Поиск по наименованию")):
    return {"q": q}
```

В этом примере параметр запроса `q` получает описание и ограничение на длину, которые отображаются в документации Swagger.

### 4. Описание ошибок и кодов статусов

FastAPI позволяет автоматически генерировать описание ошибок и кодов статусов для каждого эндпоинта. Вы можете уточнять, какие коды статусов могут быть возвращены, а также добавлять описания ошибок для пользователей API.

#### Пример описания ошибок и кодов статусов:

```python
from fastapi import HTTPException

@app.get("/items/{item_id}")
async def get_item(item_id: int):
    if item_id not in [1, 2, 3]:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"item_id": item_id}
```

FastAPI автоматически добавит описание ошибки 404 в документацию Swagger для этого эндпоинта.

### 5. Использование запросов с параметрами пути и запросами

В FastAPI можно использовать различные типы параметров для маршрутов: параметры пути, параметры запроса и тело запроса. Swagger UI автоматически различает их и отображает соответствующим образом.

#### Пример параметров пути и запроса:

```python
@app.get("/items/{item_id}")
async def get_item(item_id: int, q: str = None):
    return {"item_id": item_id, "q": q}
```

Swagger UI отобразит параметры пути (например, `item_id`) и параметры запроса (например, `q`).

### 6. Использование `tags` для группировки эндпоинтов

В FastAPI можно использовать `tags`, чтобы группировать различные эндпоинты API в документации. Это полезно для организации больших API, чтобы пользователи могли легко найти интересующие их разделы.

#### Пример использования тегов:

```python
@app.get("/items/", tags=["items"])
async def get_items():
    return {"items": ["item1", "item2"]}

@app.get("/users/", tags=["users"])
async def get_users():
    return {"users": ["user1", "user2"]}
```

Эндпоинты будут сгруппированы по категориям `items` и `users` в документации Swagger.

### 7. Поле `responses` для более точного описания ответов

В FastAPI можно указать точное описание для каждого возможного ответа с помощью поля `responses`. Это полезно, если вам нужно уточнить, какие данные могут быть возвращены для разных кодов статусов.

#### Пример использования `responses`:

```python
@app.get("/items/{item_id}", responses={404: {"description": "Item not found"}})
async def get_item(item_id: int):
    if item_id not in [1, 2, 3]:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"item_id": item_id}
```

Здесь документация Swagger будет включать подробное описание для ошибки 404.

### Заключение

FastAPI предлагает мощные возможности для работы с Swagger UI, которые делают вашу документацию не только информативной, но и удобной для использования. С помощью аннотаций типов, настроек Swagger, параметров запроса и тела запроса, а также улучшенного описания ошибок, вы можете создать точную и понятную документацию для вашего API. Эти продвинутые возможности позволяют сделать работу с FastAPI еще более эффективной и удобной.